import { parseMetaMaskError } from "../../../src/utils/parse-error";

describe("Error handling", () => {
  it.each([
    [
      {
        code: 4001,
        message: "MetaMask Tx Signature: User denied transaction signature.",
        stack:
          '{\n  "code": 4001,\n  "message": "MetaMask Tx Signature: User denied transaction signature.",\n  "stack": "Error: MetaMask Tx Signature: User denied transaction signature.\\n    at new i (chrome-extension://nkbihfbeogaeaoehlefnkodbefgpgknn/common-0.js:1:123658)\\n    at new n.EthereumProviderError (chrome-extension://nkbihfbeogaeaoehlefnkodbefgpgknn/common-0.js:1:124173)\\n    at a (chrome-extension://nkbihfbeogaeaoehlefnkodbefgpgknn/common-0.js:1:121295)\\n    at Object.userRejectedRequest (chrome-extension://nkbihfbeogaeaoehlefnkodbefgpgknn/common-0.js:1:122526)\\n    at y.<anonymous> (chrome-extension://nkbihfbeogaeaoehlefnkodbefgpgknn/background-0.js:1:220125)\\n    at Object.h (chrome-extension://nkbihfbeogaeaoehlefnkodbefgpgknn/common-0.js:18:37171)\\n    at u (chrome-extension://nkbihfbeogaeaoehlefnkodbefgpgknn/common-0.js:1:125656)\\n    at y.a.emit (chrome-extension://nkbihfbeogaeaoehlefnkodbefgpgknn/common-0.js:1:126192)\\n    at y._setTransactionStatus (chrome-extension://nkbihfbeogaeaoehlefnkodbefgpgknn/background-1.js:1:39346)\\n    at y.setTxStatusRejected (chrome-extension://nkbihfbeogaeaoehlefnkodbefgpgknn/background-1.js:1:37549)\\n    at G.cancelTransaction (chrome-extension://nkbihfbeogaeaoehlefnkodbefgpgknn/background-0.js:1:232292)\\n    at a.<anonymous> (chrome-extension://nkbihfbeogaeaoehlefnkodbefgpgknn/background-0.js:1:150068)\\n    at h (chrome-extension://nkbihfbeogaeaoehlefnkodbefgpgknn/common-0.js:1:131879)\\n    at a.s.emit (chrome-extension://nkbihfbeogaeaoehlefnkodbefgpgknn/common-0.js:1:134874)\\n    at b (chrome-extension://nkbihfbeogaeaoehlefnkodbefgpgknn/common-0.js:18:19967)\\n    at _ (chrome-extension://nkbihfbeogaeaoehlefnkodbefgpgknn/common-0.js:18:19782)\\n    at a.v.push (chrome-extension://nkbihfbeogaeaoehlefnkodbefgpgknn/common-0.js:18:20596)\\n    at t.exports._write (chrome-extension://nkbihfbeogaeaoehlefnkodbefgpgknn/common-0.js:18:144069)\\n    at v (chrome-extension://nkbihfbeogaeaoehlefnkodbefgpgknn/common-0.js:18:12100)\\n    at chrome-extension://nkbihfbeogaeaoehlefnkodbefgpgknn/common-0.js:18:15284\\n    at t.exports.y.write (chrome-extension://nkbihfbeogaeaoehlefnkodbefgpgknn/common-0.js:18:15311)\\n    at t.exports.m (chrome-extension://nkbihfbeogaeaoehlefnkodbefgpgknn/common-0.js:18:25167)\\n    at h (chrome-extension://nkbihfbeogaeaoehlefnkodbefgpgknn/common-0.js:1:131879)\\n    at t.exports.s.emit (chrome-extension://nkbihfbeogaeaoehlefnkodbefgpgknn/common-0.js:1:134874)\\n    at b (chrome-extension://nkbihfbeogaeaoehlefnkodbefgpgknn/common-0.js:18:19967)\\n    at _ (chrome-extension://nkbihfbeogaeaoehlefnkodbefgpgknn/common-0.js:18:19782)\\n    at t.exports.v.push (chrome-extension://nkbihfbeogaeaoehlefnkodbefgpgknn/common-0.js:18:20596)\\n    at t.exports._onMessage (chrome-extension://nkbihfbeogaeaoehlefnkodbefgpgknn/common-0.js:1:8708)\\n    at chrome-extension://nkbihfbeogaeaoehlefnkodbefgpgknn/common-0.js:1:8555"\n}\n  at new i (chrome-extension://nkbihfbeogaeaoehlefnkodbefgpgknn/common-0.js:1:123658)\n  at new n.EthereumProviderError (chrome-extension://nkbihfbeogaeaoehlefnkodbefgpgknn/common-0.js:1:124173)\n  at a (chrome-extension://nkbihfbeogaeaoehlefnkodbefgpgknn/common-0.js:1:121295)\n  at Object.userRejectedRequest (chrome-extension://nkbihfbeogaeaoehlefnkodbefgpgknn/common-0.js:1:122526)\n  at y.<anonymous> (chrome-extension://nkbihfbeogaeaoehlefnkodbefgpgknn/background-0.js:1:220125)\n  at Object.h (chrome-extension://nkbihfbeogaeaoehlefnkodbefgpgknn/common-0.js:18:37171)\n  at u (chrome-extension://nkbihfbeogaeaoehlefnkodbefgpgknn/common-0.js:1:125656)\n  at y.a.emit (chrome-extension://nkbihfbeogaeaoehlefnkodbefgpgknn/common-0.js:1:126192)\n  at y._setTransactionStatus (chrome-extension://nkbihfbeogaeaoehlefnkodbefgpgknn/background-1.js:1:39346)\n  at y.setTxStatusRejected (chrome-extension://nkbihfbeogaeaoehlefnkodbefgpgknn/background-1.js:1:37549)\n  at G.cancelTransaction (chrome-extension://nkbihfbeogaeaoehlefnkodbefgpgknn/background-0.js:1:232292)\n  at a.<anonymous> (chrome-extension://nkbihfbeogaeaoehlefnkodbefgpgknn/background-0.js:1:150068)\n  at h (chrome-extension://nkbihfbeogaeaoehlefnkodbefgpgknn/common-0.js:1:131879)\n  at a.s.emit (chrome-extension://nkbihfbeogaeaoehlefnkodbefgpgknn/common-0.js:1:134874)\n  at b (chrome-extension://nkbihfbeogaeaoehlefnkodbefgpgknn/common-0.js:18:19967)\n  at _ (chrome-extension://nkbihfbeogaeaoehlefnkodbefgpgknn/common-0.js:18:19782)\n  at a.v.push (chrome-extension://nkbihfbeogaeaoehlefnkodbefgpgknn/common-0.js:18:20596)\n  at t.exports._write (chrome-extension://nkbihfbeogaeaoehlefnkodbefgpgknn/common-0.js:18:144069)\n  at v (chrome-extension://nkbihfbeogaeaoehlefnkodbefgpgknn/common-0.js:18:12100)\n  at chrome-extension://nkbihfbeogaeaoehlefnkodbefgpgknn/common-0.js:18:15284\n  at t.exports.y.write (chrome-extension://nkbihfbeogaeaoehlefnkodbefgpgknn/common-0.js:18:15311)\n  at t.exports.m (chrome-extension://nkbihfbeogaeaoehlefnkodbefgpgknn/common-0.js:18:25167)\n  at h (chrome-extension://nkbihfbeogaeaoehlefnkodbefgpgknn/common-0.js:1:131879)\n  at t.exports.s.emit (chrome-extension://nkbihfbeogaeaoehlefnkodbefgpgknn/common-0.js:1:134874)\n  at b (chrome-extension://nkbihfbeogaeaoehlefnkodbefgpgknn/common-0.js:18:19967)\n  at _ (chrome-extension://nkbihfbeogaeaoehlefnkodbefgpgknn/common-0.js:18:19782)\n  at t.exports.v.push (chrome-extension://nkbihfbeogaeaoehlefnkodbefgpgknn/common-0.js:18:20596)\n  at t.exports._onMessage (chrome-extension://nkbihfbeogaeaoehlefnkodbefgpgknn/common-0.js:1:8708)\n  at chrome-extension://nkbihfbeogaeaoehlefnkodbefgpgknn/common-0.js:1:8555',
      },
      "User rejected the request.",
    ],
    [
      {
        code: -32603,
        message: "Internal JSON-RPC error.",
        data: {
          code: 3,
          message:
            "execution reverted: ERC1155Sale: Seller does not have enough tokens left",
          data: "0x08c379a0000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000344552433131353553616c653a2053656c6c657220646f6573206e6f74206861766520656e6f75676820746f6b656e73206c656674000000000000000000000000",
        },
      },
      "Seller does not have enough tokens left",
    ],
    [
      {
        code: -32603,
        message:
          '[ethjs-query] while formatting outputs from RPC \'{"value":{"code":-32603,"data":{"code":-32000,"message":"Nonce too high. Expected nonce to be 0 but got 2. Note that transactions can\'t be queued when automining."}}}\'',
        stack:
          '{\n  "code": -32603,\n  "message": "[ethjs-query] while formatting outputs from RPC \'{\\"value\\":{\\"code\\":-32603,\\"data\\":{\\"code\\":-32000,\\"message\\":\\"Nonce too high. Expected nonce to be 0 but got 2. Note that transactions can\'t be queued when automining.\\"}}}\'",\n  "stack": "Error: [ethjs-query] while formatting outputs from RPC \'{\\"value\\":{\\"code\\":-32603,\\"data\\":{\\"code\\":-32000,\\"message\\":\\"Nonce too high. Expected nonce to be 0 but got 2. Note that transactions can\'t be queued when automining.\\"}}}\'\\n    at new n (chrome-extension://nkbihfbeogaeaoehlefnkodbefgpgknn/common-1.js:27:365635)\\n    at a (chrome-extension://nkbihfbeogaeaoehlefnkodbefgpgknn/common-1.js:27:368611)\\n    at Object.internal (chrome-extension://nkbihfbeogaeaoehlefnkodbefgpgknn/common-1.js:27:369221)\\n    at y.<anonymous> (chrome-extension://nkbihfbeogaeaoehlefnkodbefgpgknn/background-3.js:3:399296)\\n    at Object.u (chrome-extension://nkbihfbeogaeaoehlefnkodbefgpgknn/common-2.js:46:9177)\\n    at u (chrome-extension://nkbihfbeogaeaoehlefnkodbefgpgknn/common-6.js:3:1222)\\n    at y.s.emit (chrome-extension://nkbihfbeogaeaoehlefnkodbefgpgknn/common-6.js:3:1758)\\n    at y._setTransactionStatus (chrome-extension://nkbihfbeogaeaoehlefnkodbefgpgknn/background-3.js:3:443715)\\n    at y.setTxStatusFailed (chrome-extension://nkbihfbeogaeaoehlefnkodbefgpgknn/background-3.js:3:442947)\\n    at O._failTransaction (chrome-extension://nkbihfbeogaeaoehlefnkodbefgpgknn/background-3.js:3:423748)\\n    at O.approveTransaction (chrome-extension://nkbihfbeogaeaoehlefnkodbefgpgknn/background-3.js:3:410397)\\n    at async O.updateAndApproveTransaction (chrome-extension://nkbihfbeogaeaoehlefnkodbefgpgknn/background-3.js:3:409621)\\n    at async s.<anonymous> (chrome-extension://nkbihfbeogaeaoehlefnkodbefgpgknn/background-4.js:10:15025)"\n}\n  at new n (chrome-extension://nkbihfbeogaeaoehlefnkodbefgpgknn/common-1.js:27:365635)\n  at a (chrome-extension://nkbihfbeogaeaoehlefnkodbefgpgknn/common-1.js:27:368611)\n  at Object.internal (chrome-extension://nkbihfbeogaeaoehlefnkodbefgpgknn/common-1.js:27:369221)\n  at y.<anonymous> (chrome-extension://nkbihfbeogaeaoehlefnkodbefgpgknn/background-3.js:3:399296)\n  at Object.u (chrome-extension://nkbihfbeogaeaoehlefnkodbefgpgknn/common-2.js:46:9177)\n  at u (chrome-extension://nkbihfbeogaeaoehlefnkodbefgpgknn/common-6.js:3:1222)\n  at y.s.emit (chrome-extension://nkbihfbeogaeaoehlefnkodbefgpgknn/common-6.js:3:1758)\n  at y._setTransactionStatus (chrome-extension://nkbihfbeogaeaoehlefnkodbefgpgknn/background-3.js:3:443715)\n  at y.setTxStatusFailed (chrome-extension://nkbihfbeogaeaoehlefnkodbefgpgknn/background-3.js:3:442947)\n  at O._failTransaction (chrome-extension://nkbihfbeogaeaoehlefnkodbefgpgknn/background-3.js:3:423748)\n  at O.approveTransaction (chrome-extension://nkbihfbeogaeaoehlefnkodbefgpgknn/background-3.js:3:410397)\n  at async O.updateAndApproveTransaction (chrome-extension://nkbihfbeogaeaoehlefnkodbefgpgknn/background-3.js:3:409621)\n  at async s.<anonymous> (chrome-extension://nkbihfbeogaeaoehlefnkodbefgpgknn/background-4.js:10:15025)',
      },
      "Nonce too high, you most likely have to reset your account.",
    ],
    [
      {
        reason:
          "cannot estimate gas; transaction may fail or may require manual gas limit",
        code: "UNPREDICTABLE_GAS_LIMIT",
        error: {
          code: -32603,
          message:
            "execution reverted: Whitelist: You are not whitelisted or public sale has not started",
          data: {
            originalError: {
              code: 3,
              data: "0x08c379a00000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000004157686974656c6973743a20596f7520617265206e6f742077686974656c6973746564206f72207075626c69632073616c6520686173206e6f74207374617274656400000000000000000000000000000000000000000000000000000000000000",
              message:
                "execution reverted: Whitelist: You are not whitelisted or public sale has not started",
            },
          },
        },
        method: "estimateGas",
        transaction: {
          from: "0xd4039eB67CBB36429Ad9DD30187B94f6A5122215",
          to: "0x25f4e3e81c09dc7eDaBC965509A825fdA88E164d",
          value: { type: "BigNumber", hex: "0x3ff2e795f50000" },
          data: "0x5dc768f80000000000000000000000000000000000000000000000000000000000000080000000000000000000000000d4039eb67cbb36429ad9dd30187b94f6a5122215000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000004200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004a9b63844880000000000000000000000000000000000000000000000000000000000000002710000000000000000000000000a508dd875f10c33c52a8abb20e16fc68e981f186000000000000000000000000a508dd875f10c33c52a8abb20e16fc68e981f18600000000000000000000000000000000000000000000000000000000627e031c00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000018000000000000000000000000000000000000000000000000000000000000001a00000000000000000000000000000000000000000000000000000000000000220000000000000000000000000000000000000000000000000000000000000032000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000041decae8cff8b191994d3d6d579874a00225e65011e5a7414b463b8a31101a4350563f38a1c370069ef481ba171abec4de3777f8fb668b80a78f5dbafaf639ffd11b0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000e0000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000000a00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000415306e3a93262ee4fd49425a645d53d2d73c187444dfb87836d5bb0520d5b0cc83a620cd316c7abf268fe112b0eb1ae7a385048ff51f75efe830af8a056f290461b000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002710000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000627e01f0000000000000000000000000000000000000000000000000003ff2e795f5000000000000000000000000000000000000000000000000000000000000000000417072e2726d2d1798f8daa6da7e2df4c3ed7f043861af09be58b6a34a5c8d57f13a7c535476bc797a971c4aa2e10866f49b3d5fd7ccbf9cb3085a6d50cb885e621c00000000000000000000000000000000000000000000000000000000000000",
          accessList: null,
        },
      },
      "You are not whitelisted or public sale has not started",
    ],
    [
      {
        reason:
          "cannot estimate gas; transaction may fail or may require manual gas limit",
        code: "UNPREDICTABLE_GAS_LIMIT",
        error: {
          code: -32603,
          message: "execution reverted: MintVoucher: unauthorized signature",
          data: {
            originalError: {
              code: 3,
              data: "0x08c379a0000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000234d696e74566f75636865723a20756e617574686f72697a6564207369676e61747572650000000000000000000000000000000000000000000000000000000000",
              message:
                "execution reverted: MintVoucher: unauthorized signature",
            },
          },
        },
        method: "estimateGas",
        transaction: {
          from: "0xd4039eB67CBB36429Ad9DD30187B94f6A5122215",
          to: "0x98766F6Bb7645d00A9111953C700bc67852Cf729",
          value: { type: "BigNumber", hex: "0x011c37937e080000" },
          data: "0x02a5084c0000000000000000000000000000000000000000000000000000000000000060000000000000000000000000d4039eb67cbb36429ad9dd30187b94f6a512221500000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000011c37937e08000000000000000000000000000000000000000000000000000000000000000003e80000000000000000000000007940a93584e12bce85a63b74dd03abe86fa67cbd000000000000000000000000a508dd875f10c33c52a8abb20e16fc68e981f18600000000000000000000000000000000000000000000000000000000629481b400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000018000000000000000000000000000000000000000000000000000000000000001a0000000000000000000000000000000000000000000000000000000000000022000000000000000000000000000000000000000000000000000000000000003200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004184813793c30b3215c0b298c62524dc996e9e8ad000a1d705e7ff0cbda77c151d792537e361cd0ad389cb50d4f3ddf3234215226e1301cc91a52870a261d903171c0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000e0000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000000a00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000413a793aa50cfc2fd3368f7b8dd2c9a4d485d9874bf39c488fb6fbfcdee2ef6d295b31a267893d41bdce5bd5d11660dfbfea4c4e9c9e26a84520ace9e03a0b4d1a1b00000000000000000000000000000000000000000000000000000000000000",
          accessList: null,
        },
      },
      "Unable to finalize this sale, it might no longer be active.",
    ],
    [
      {
        code: -32000,
        message:
          "err: insufficient funds for gas * price + value: address 0xD2E49cfd5c03a72a838a2fC6bB5f6b46927e731A have 0 want 21000000000000000 (supplied gas 15010499)",
      },
      "Insufficient funds, please top up your account and try again.",
    ],
    [
      {
        reason:
          "cannot estimate gas; transaction may fail or may require manual gas limit",
        code: "UNPREDICTABLE_GAS_LIMIT",
        error: {
          reason:
            "Error: VM Exception while processing transaction: reverted with reason string 'Auction: Auction has not ended'",
          code: "UNPREDICTABLE_GAS_LIMIT",
          method: "estimateGas",
          transaction: {
            from: "0x9fe893f7FC9A46825D4449Fef0811ab00eB5b759",
            maxPriorityFeePerGas: { type: "BigNumber", hex: "0x9502f900" },
            maxFeePerGas: { type: "BigNumber", hex: "0x9502f910" },
            to: "0x7b5695eaDEDA83f506D784E16Bb7b8Fc5030A50d",
            data: "0x6ab123852e407a03ee0cff23fdfa7274a3e03e6852b631641dacc893af3cdb8dcdc43cb60000000000000000000000000000000000000000000000000000000000000060000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
            type: 2,
            accessList: null,
          },
          error: {
            reason: "processing response error",
            code: "SERVER_ERROR",
            body: '{"jsonrpc":"2.0","id":472,"error":{"code":-32603,"message":"Error: VM Exception while processing transaction: reverted with reason string \'Auction: Auction has not ended\'","data":{"message":"Error: VM Exception while processing transaction: reverted with reason string \'Auction: Auction has not ended\'","data":"0x08c379a00000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000001e41756374696f6e3a2041756374696f6e20686173206e6f7420656e6465640000"}}}',
            error: {
              code: -32603,
              data: {
                message:
                  "Error: VM Exception while processing transaction: reverted with reason string 'Auction: Auction has not ended'",
                data: "0x08c379a00000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000001e41756374696f6e3a2041756374696f6e20686173206e6f7420656e6465640000",
              },
            },
            requestBody:
              '{"method":"eth_estimateGas","params":[{"type":"0x2","maxFeePerGas":"0x9502f910","maxPriorityFeePerGas":"0x9502f900","from":"0x9fe893f7fc9a46825d4449fef0811ab00eb5b759","to":"0x7b5695eadeda83f506d784e16bb7b8fc5030a50d","data":"0x6ab123852e407a03ee0cff23fdfa7274a3e03e6852b631641dacc893af3cdb8dcdc43cb60000000000000000000000000000000000000000000000000000000000000060000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"}],"id":472,"jsonrpc":"2.0"}',
            requestMethod: "POST",
            url: "http://localhost:8545",
          },
        },
        tx: {
          data: "0x6ab123852e407a03ee0cff23fdfa7274a3e03e6852b631641dacc893af3cdb8dcdc43cb60000000000000000000000000000000000000000000000000000000000000060000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
          to: {},
          maxFeePerGas: { type: "BigNumber", hex: "0x9502f910" },
          maxPriorityFeePerGas: { type: "BigNumber", hex: "0x9502f900" },
          from: "0x9fe893f7FC9A46825D4449Fef0811ab00eB5b759",
          type: 2,
          nonce: {},
          gasLimit: {},
          chainId: {},
        },
      },
      "Auction has not ended",
    ],
    [
      {
        reason:
          "cannot estimate gas; transaction may fail or may require manual gas limit",
        code: "UNPREDICTABLE_GAS_LIMIT",
        error: {
          reason:
            "Error: VM Exception while processing transaction: reverted with reason string 'Whitelist: Limit reached for this stage'",
          code: "UNPREDICTABLE_GAS_LIMIT",
          method: "estimateGas",
          transaction: {
            from: "0x9d2b8DFd7B8F33Cf84499Ac2df74896174AAb98C",
            maxPriorityFeePerGas: { type: "BigNumber", hex: "0x9502f900" },
            maxFeePerGas: { type: "BigNumber", hex: "0x9502f910" },
            to: "0x60D158E201Fb0780Bb1D6d4a36fe181385De4D29",
            value: { type: "BigNumber", hex: "0x0e398811bec68000" },
            data: "0x0d7a45ef000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000002a0000000000000000000000000306d717d109e0995e0f56027eb93d9c1d5686de100000000000000000000000000000000000000000000000000000000000002310000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000de0b6b3a76400000000000000000000000000000000000000000000000000000000000062e79475000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000009fe893f7fc9a46825d4449fef0811ab00eb5b75900000000000000000000000000000000000000000000000000000000000001a00000000000000000000000000000000000000000000000000000000000000220000000000000000000000000000000000000000000000000000000000000024000000000000000000000000000000000000000000000000000000000000000418a6997d42b90061216f5200cb3cb6b6843b1db415a8a1b5262a65a82f7fad8b34f6d5e4e87da4bdeb81efe7fe3f35abb169a3f76772dc5401f925d967441047a1b0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000800000000000000000000000000000000000000000000000000000000062e0fcf500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000041e4b2e002acac61a63df8bdcbd8db17b2b9368fd2a18cb09fde7e86a198fc19884daf872b9f93fd26f1bda2be35a8da10a4c5efeacd0eb7ea332ed602a6a588b31c00000000000000000000000000000000000000000000000000000000000000",
            type: 2,
            accessList: null,
          },
          error: {
            reason: "processing response error",
            code: "SERVER_ERROR",
            body: '{"jsonrpc":"2.0","id":124,"error":{"code":-32603,"message":"Error: VM Exception while processing transaction: reverted with reason string \'Whitelist: Limit reached for this stage\'","data":{"message":"Error: VM Exception while processing transaction: reverted with reason string \'Whitelist: Limit reached for this stage\'","data":"0x08c379a00000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000002757686974656c6973743a204c696d6974207265616368656420666f72207468697320737461676500000000000000000000000000000000000000000000000000"}}}',
            error: {
              code: -32603,
              data: {
                message:
                  "Error: VM Exception while processing transaction: reverted with reason string 'Whitelist: Limit reached for this stage'",
                data: "0x08c379a00000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000002757686974656c6973743a204c696d6974207265616368656420666f72207468697320737461676500000000000000000000000000000000000000000000000000",
              },
            },
            requestBody:
              '{"method":"eth_estimateGas","params":[{"type":"0x2","maxFeePerGas":"0x9502f910","maxPriorityFeePerGas":"0x9502f900","value":"0xe398811bec68000","from":"0x9d2b8dfd7b8f33cf84499ac2df74896174aab98c","to":"0x60d158e201fb0780bb1d6d4a36fe181385de4d29","data":"0x0d7a45ef000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000002a0000000000000000000000000306d717d109e0995e0f56027eb93d9c1d5686de100000000000000000000000000000000000000000000000000000000000002310000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000de0b6b3a76400000000000000000000000000000000000000000000000000000000000062e79475000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000009fe893f7fc9a46825d4449fef0811ab00eb5b75900000000000000000000000000000000000000000000000000000000000001a00000000000000000000000000000000000000000000000000000000000000220000000000000000000000000000000000000000000000000000000000000024000000000000000000000000000000000000000000000000000000000000000418a6997d42b90061216f5200cb3cb6b6843b1db415a8a1b5262a65a82f7fad8b34f6d5e4e87da4bdeb81efe7fe3f35abb169a3f76772dc5401f925d967441047a1b0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000800000000000000000000000000000000000000000000000000000000062e0fcf500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000041e4b2e002acac61a63df8bdcbd8db17b2b9368fd2a18cb09fde7e86a198fc19884daf872b9f93fd26f1bda2be35a8da10a4c5efeacd0eb7ea332ed602a6a588b31c00000000000000000000000000000000000000000000000000000000000000"}],"id":124,"jsonrpc":"2.0"}',
            requestMethod: "POST",
            url: "http://localhost:8545",
          },
        },
        tx: {
          data: "0x0d7a45ef000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000002a0000000000000000000000000306d717d109e0995e0f56027eb93d9c1d5686de100000000000000000000000000000000000000000000000000000000000002310000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000de0b6b3a76400000000000000000000000000000000000000000000000000000000000062e79475000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000009fe893f7fc9a46825d4449fef0811ab00eb5b75900000000000000000000000000000000000000000000000000000000000001a00000000000000000000000000000000000000000000000000000000000000220000000000000000000000000000000000000000000000000000000000000024000000000000000000000000000000000000000000000000000000000000000418a6997d42b90061216f5200cb3cb6b6843b1db415a8a1b5262a65a82f7fad8b34f6d5e4e87da4bdeb81efe7fe3f35abb169a3f76772dc5401f925d967441047a1b0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000800000000000000000000000000000000000000000000000000000000062e0fcf500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000041e4b2e002acac61a63df8bdcbd8db17b2b9368fd2a18cb09fde7e86a198fc19884daf872b9f93fd26f1bda2be35a8da10a4c5efeacd0eb7ea332ed602a6a588b31c00000000000000000000000000000000000000000000000000000000000000",
          to: {},
          maxFeePerGas: { type: "BigNumber", hex: "0x9502f910" },
          maxPriorityFeePerGas: { type: "BigNumber", hex: "0x9502f900" },
          from: "0x9d2b8DFd7B8F33Cf84499Ac2df74896174AAb98C",
          value: { type: "BigNumber", hex: "0x0e398811bec68000" },
          type: 2,
          nonce: {},
          gasLimit: {},
          chainId: {},
        },
      },
      "Limit reached for this stage",
    ],
    [
      {
        reason:
          "cannot estimate gas; transaction may fail or may require manual gas limit",
        code: "UNPREDICTABLE_GAS_LIMIT",
        error: {
          reason:
            "Error: VM Exception while processing transaction: reverted with reason string 'Whitelist: You are not whitelisted or public sale has not started'",
          code: "UNPREDICTABLE_GAS_LIMIT",
          method: "estimateGas",
          transaction: {
            from: "0x9d2b8DFd7B8F33Cf84499Ac2df74896174AAb98C",
            maxPriorityFeePerGas: { type: "BigNumber", hex: "0x9502f900" },
            maxFeePerGas: { type: "BigNumber", hex: "0x9502f910" },
            to: "0x60D158E201Fb0780Bb1D6d4a36fe181385De4D29",
            value: { type: "BigNumber", hex: "0x0e398811bec68000" },
            data: "0xb369bec30000000000000000000000000000000000000000000000000000000000000020000000000000000000000000306d717d109e0995e0f56027eb93d9c1d5686de1000000000000000000000000000000000000000000000000000000000000022e0000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000de0b6b3a76400000000000000000000000000000000000000000000000000000000000062e7946e000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000009fe893f7fc9a46825d4449fef0811ab00eb5b75900000000000000000000000000000000000000000000000000000000000001a0000000000000000000000000000000000000000000000000000000000000022000000000000000000000000000000000000000000000000000000000000002400000000000000000000000000000000000000000000000000000000000000041fafbe16787b452efffb0882de3d539d5daec40bd6da8d6c477738d8f2e57f0ad73fe9079394ced20760880699cb7e9cda9ea044a7bc145e9ae7229e1e88fceaa1c0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
            type: 2,
            accessList: null,
          },
          error: {
            reason: "processing response error",
            code: "SERVER_ERROR",
            body: '{"jsonrpc":"2.0","id":92,"error":{"code":-32603,"message":"Error: VM Exception while processing transaction: reverted with reason string \'Whitelist: You are not whitelisted or public sale has not started\'","data":{"message":"Error: VM Exception while processing transaction: reverted with reason string \'Whitelist: You are not whitelisted or public sale has not started\'","data":"0x08c379a00000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000004157686974656c6973743a20596f7520617265206e6f742077686974656c6973746564206f72207075626c69632073616c6520686173206e6f74207374617274656400000000000000000000000000000000000000000000000000000000000000"}}}',
            error: {
              code: -32603,
              data: {
                message:
                  "Error: VM Exception while processing transaction: reverted with reason string 'Whitelist: You are not whitelisted or public sale has not started'",
                data: "0x08c379a00000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000004157686974656c6973743a20596f7520617265206e6f742077686974656c6973746564206f72207075626c69632073616c6520686173206e6f74207374617274656400000000000000000000000000000000000000000000000000000000000000",
              },
            },
            requestBody:
              '{"method":"eth_estimateGas","params":[{"type":"0x2","maxFeePerGas":"0x9502f910","maxPriorityFeePerGas":"0x9502f900","value":"0xe398811bec68000","from":"0x9d2b8dfd7b8f33cf84499ac2df74896174aab98c","to":"0x60d158e201fb0780bb1d6d4a36fe181385de4d29","data":"0xb369bec30000000000000000000000000000000000000000000000000000000000000020000000000000000000000000306d717d109e0995e0f56027eb93d9c1d5686de1000000000000000000000000000000000000000000000000000000000000022e0000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000de0b6b3a76400000000000000000000000000000000000000000000000000000000000062e7946e000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000009fe893f7fc9a46825d4449fef0811ab00eb5b75900000000000000000000000000000000000000000000000000000000000001a0000000000000000000000000000000000000000000000000000000000000022000000000000000000000000000000000000000000000000000000000000002400000000000000000000000000000000000000000000000000000000000000041fafbe16787b452efffb0882de3d539d5daec40bd6da8d6c477738d8f2e57f0ad73fe9079394ced20760880699cb7e9cda9ea044a7bc145e9ae7229e1e88fceaa1c0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"}],"id":92,"jsonrpc":"2.0"}',
            requestMethod: "POST",
            url: "http://localhost:8545",
          },
        },
        tx: {
          data: "0xb369bec30000000000000000000000000000000000000000000000000000000000000020000000000000000000000000306d717d109e0995e0f56027eb93d9c1d5686de1000000000000000000000000000000000000000000000000000000000000022e0000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000de0b6b3a76400000000000000000000000000000000000000000000000000000000000062e7946e000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000009fe893f7fc9a46825d4449fef0811ab00eb5b75900000000000000000000000000000000000000000000000000000000000001a0000000000000000000000000000000000000000000000000000000000000022000000000000000000000000000000000000000000000000000000000000002400000000000000000000000000000000000000000000000000000000000000041fafbe16787b452efffb0882de3d539d5daec40bd6da8d6c477738d8f2e57f0ad73fe9079394ced20760880699cb7e9cda9ea044a7bc145e9ae7229e1e88fceaa1c0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
          to: {},
          maxFeePerGas: { type: "BigNumber", hex: "0x9502f910" },
          maxPriorityFeePerGas: { type: "BigNumber", hex: "0x9502f900" },
          from: "0x9d2b8DFd7B8F33Cf84499Ac2df74896174AAb98C",
          value: { type: "BigNumber", hex: "0x0e398811bec68000" },
          type: 2,
          nonce: {},
          gasLimit: {},
          chainId: {},
        },
      },
      "You are not whitelisted or public sale has not started",
    ],
    [
      {
        reason:
          "Error: VM Exception while processing transaction: reverted with reason string 'Auction: Only admin or auction owner can result the auction'",
        code: "UNPREDICTABLE_GAS_LIMIT",
        method: "estimateGas",
        transaction: {
          from: "0x9d2b8DFd7B8F33Cf84499Ac2df74896174AAb98C",
          to: "0x7b5695eaDEDA83f506D784E16Bb7b8Fc5030A50d",
          data: "0x3ef4d1302e407a03ee0cff23fdfa7274a3e03e6852b631641dacc893af3cdb8dcdc43cb6",
          accessList: null,
        },
        error: {
          code: -32603,
          message: "Internal JSON-RPC error.",
          data: {
            code: -32603,
            message:
              "Error: VM Exception while processing transaction: reverted with reason string 'Auction: Only admin or auction owner can result the auction'",
            data: {
              message:
                "Error: VM Exception while processing transaction: reverted with reason string 'Auction: Only admin or auction owner can result the auction'",
              data: "0x08c379a00000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000003b41756374696f6e3a204f6e6c792061646d696e206f722061756374696f6e206f776e65722063616e20726573756c74207468652061756374696f6e0000000000",
            },
          },
          stack:
            '{\n  "code": -32603,\n  "message": "Internal JSON-RPC error.",\n  "data": {\n    "code": -32603,\n    "message": "Error: VM Exception while processing transaction: reverted with reason string \'Auction: Only admin or auction owner can result the auction\'",\n    "data": {\n      "message": "Error: VM Exception while processing transaction: reverted with reason string \'Auction: Only admin or auction owner can result the auction\'",\n      "data": "0x08c379a00000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000003b41756374696f6e3a204f6e6c792061646d696e206f722061756374696f6e206f776e65722063616e20726573756c74207468652061756374696f6e0000000000"\n    }\n  },\n  "stack": "Error: Internal JSON-RPC error.\\n    at new i (chrome-extension://nkbihfbeogaeaoehlefnkodbefgpgknn/common-2.js:1:308657)\\n    at a (chrome-extension://nkbihfbeogaeaoehlefnkodbefgpgknn/common-2.js:1:311413)\\n    at Object.internal (chrome-extension://nkbihfbeogaeaoehlefnkodbefgpgknn/common-2.js:1:312023)\\n    at c (chrome-extension://nkbihfbeogaeaoehlefnkodbefgpgknn/background-3.js:3:101606)\\n    at chrome-extension://nkbihfbeogaeaoehlefnkodbefgpgknn/background-3.js:3:102638\\n    at async chrome-extension://nkbihfbeogaeaoehlefnkodbefgpgknn/common-6.js:1:3412"\n}\n  at new i (chrome-extension://nkbihfbeogaeaoehlefnkodbefgpgknn/common-2.js:1:308657)\n  at a (chrome-extension://nkbihfbeogaeaoehlefnkodbefgpgknn/common-2.js:1:311413)\n  at Object.internal (chrome-extension://nkbihfbeogaeaoehlefnkodbefgpgknn/common-2.js:1:312023)\n  at c (chrome-extension://nkbihfbeogaeaoehlefnkodbefgpgknn/background-3.js:3:101606)\n  at chrome-extension://nkbihfbeogaeaoehlefnkodbefgpgknn/background-3.js:3:102638\n  at async chrome-extension://nkbihfbeogaeaoehlefnkodbefgpgknn/common-6.js:1:3412',
        },
      },
      "Only admin or auction owner can result the auction",
    ],
  ])("Should parse correctly", (error, output) => {
    const parsedError = parseMetaMaskError(error);

    expect(parsedError.message).toEqual(output);
  });
});
